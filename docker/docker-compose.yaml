networks:
  server:
  ac:

services:
  nhp-server:
    image: opennhp-server
    build: 
      context: ../..
      dockerfile: ./opennhp/docker/Dockerfile.server
    container_name: nhp-server
    restart: always
    networks:
      - server
    volumes:
      - ./nhp-server/etc/:/nhp-server/etc/:rw
      - ./nhp-server/templates/:/nhp-server/templates/:rw
      - ./nhp-server/plugins/example/etc/:/nhp-server/plugins/example/etc/:rw
      - ./nhp-server/plugins/passcode/etc/:/nhp-server/plugins/passcode/etc/:rw
      - ./nhp-server/logs/:/nhp-server/logs/:rw
    ports:
      - "62206:62206/udp"
      - "62206:62206/tcp"

  nhp-ac:
    image: opennhp-ac
    container_name: nhp-ac
    build: 
      context: ../../..
      dockerfile: ./fengyily/opennhp/docker/Dockerfile.ac
    volumes:
      - ../../../traefik-plugins/traefik-plugins-hqdata/plugins-local/:/opt/traefik/plugins-local/
      - ./nhp-ac/etc/:/nhp-ac/etc/
      - ./nhp-ac/traefik/etc/hqdata-traefik.toml:/opt/traefik/hqdata-traefik.toml
      - ./nhp-ac/traefik/etc/hqdata-provider.toml:/opt/traefik/hqdata-provider.toml
      - ./nhp-ac/logs/:/nhp-ac/logs/
    restart: always
    cap_add:
      - NET_ADMIN
    depends_on:
      - nhp-server
    networks:
      - ac
    ports:
      - "80:80"

  nhp-agent:
    image: opennhp-agent
    build: 
      context: ..
      dockerfile: ./docker/Dockerfile.agent
    container_name: nhp-agent
    restart: always
    volumes:
      - ./nhp-agent/etc/:/nhp-agent/etc/:rw
      - ./nhp-agent/logs/:/nhp-agent/logs/:rw
    networks:
      - ac

  nhp-app:
    image: nginx:latest
    container_name: nhp-app
    restart: always
    # ports:
    #   - "8080:80"
    networks:
      - ac

  # nhp-base:
  #   image: opennhp-base
  #   build: 
  #     context: ..
  #     dockerfile: ./docker/Dockerfile.base
  #   container_name: nhp-base
  #   restart: always
